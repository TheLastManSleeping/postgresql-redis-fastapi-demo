# Демонстрационный стенд: FastAPI + PostgreSQL + Redis
Этот проект представляет собой полнофункциональный, готовый к запуску демонстрационный стенд, который одной командой разворачивает окружение для веб-приложения на FastAPI с использованием PostgreSQL в качестве основной базы данных и Redis для кэширования.

Стенд наглядно демонстрирует:
- Реализацию **CRUD**-операций (Create, Read, Update, Delete).
- Резкое повышение производительности за счет **кэширования** «тяжелых» запросов в Redis.

---

## Ключевые особенности

- **Redis**: Высокопроизводительная In-memory СУБД, используемая в качестве кэша для ускорения ответов.
- **Автоматизация**: Скрипты для автоматической загрузки данных и инициализации базы при первом запуске.
- **CRUD + Stats**: Реализованы как стандартные CRUD-операции, так и «тяжелый» аналитический эндпоинт для демонстрации кэша.

---

## Архитектура запуска

Проект использует Docker Compose для управления жизненным циклом сервисов. Порядок запуска строго определен для корректной инициализации:

1.  Запускаются базовые сервисы: `postgres_db` и `redis_cache`.
2.  Запускается одноразовый сервис `downloader`, который скачивает необходимые наборы данных в общий том `data_volume`.
3.  Сервис `db_init` ожидает, пока `postgres_db` будет готов к работе **И** `downloader` успешно завершит свою задачу.
4.  После этого `db_init` запускает Python-скрипт, который создает таблицы и загружает все скачанные данные в PostgreSQL.
5.  И только после успешного завершения `db_init`, запускается основной сервис `fastapi_app`, который теперь гарантированно имеет доступ к полностью готовой базе данных.

---

## Начало работы

### Требования

-   **Docker**
-   **Docker Compose**

### Запуск

1.  Клонируйте репозиторий на ваш компьютер:
    ```bash
    git clone [https://github.com/new](https://github.com/new)
    cd [название папки проекта]
    ```

2.  Запустите все сервисы одной командой:
    ```bash
    docker-compose up --build
    ```

> **ВНИМАНИЕ! Первый запуск будет ОЧЕНЬ долгим.**
> Процесс может занять пару минут или даже больше, в зависимости от скорости вашего интернета и диска. Система будет скачивать сотни мегабайт данных и загружать их в базу.


---

## Использование

### Интерактивная документация

После успешного запуска интерактивная документация API (Swagger UI) будет доступна по адресу:
**[http://localhost:8000/docs](http://localhost:8000/docs)**

Через этот интерфейс вы можете тестировать все эндпоинты.

### Демонстрация кэширования

Это главный сценарий для демонстрации.

1.  **Первый запрос (без кэша):**
    Выполните в терминале команду. Она будет выполняться **долго**.

    ```bash
    time curl http://localhost:8000/trips/stats/by-passenger-count
    ```

2.  **Второй запрос (с кэшем):**
    Сразу после первого выполните ту же команду. Она вернет результат **мгновенно**.

    ```bash
    time curl http://localhost:8000/trips/stats/by-passenger-count
    ```
    Вы также можете следить за логами контейнера `fastapi_app` (`docker-compose logs -f fastapi_app`), чтобы увидеть сообщения `❌ Cache MISS!` и `✅ Cache HIT!`.

### CRUD-операции

В интерактивной документации (`/docs`) доступен полный набор эндпоинтов для управления записями о поездках (`/trips/`):
- `POST /trips/`: Создание новой поездки.
- `GET /trips/{trip_id}`: Получение поездки по ID (этот эндпоинт также кэшируется).
- `PUT /trips/{trip_id}`: Обновление поездки.
- `DELETE /trips/{trip_id}`: Удаление поездки.

---

## Структура проекта

```
/
|-- docker-compose.yml       # Главный файл оркестровки
|-- README.md                # Эта документация
|-- fastapi_app/
|   |-- Dockerfile           # Инструкции по сборке образа FastAPI
|   |-- requirements.txt     # Зависимости Python
|   |-- app/
|   |   |-- __init__.py
|   |   |-- main.py          # Логика API-эндпоинтов
|   |   |-- crud.py          # Функции для взаимодействия с БД
|   |   |-- models.py        # Модели таблиц SQLAlchemy
|   |   |-- schemas.py       # Схемы данных Pydantic
|   |   |-- database.py      # Настройка подключения к БД
|   |   |-- config.py        # Конфигурация приложения
|-- scripts/
|   |-- download_data.sh     # Скрипт для скачивания данных
|   |-- init_db.py           # Скрипт для инициализации и загрузки данных в БД
```